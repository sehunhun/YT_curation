<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube ì±„ë„ ë¶„ì„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body {
      background-color: #0d1317;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <h1 class="text-3xl font-bold mb-4">YouTube ì±„ë„ ë¶„ì„</h1>
    <p class="text-gray-400 mb-6">
      ê²€ìƒ‰ì–´ "ë¶€ì—…"ìœ¼ë¡œ ì±„ë„ì„ ê²€ìƒ‰í•˜ê³ , êµ¬ë…ì ìˆ˜ 2000 ì´ìƒì¸ ì±„ë„ì˜ ì •ë³´ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
    </p>
    
    <div class="mb-6">
      <label class="block text-sm font-medium mb-2">YouTube API Key:</label>
      <input 
        type="text" 
        id="apiKey" 
        placeholder="YouTube API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”"
        class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-700 focus:border-blue-500 focus:outline-none mb-4"
      />
      <div class="flex items-center gap-4">
        <label class="block text-sm font-medium">ê²€ìƒ‰í•  ìµœëŒ€ ì±„ë„ ê°œìˆ˜:</label>
        <input 
          type="number" 
          id="maxResults" 
          value="50"
          min="1"
          max="500"
          class="w-24 px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-700 focus:border-blue-500 focus:outline-none"
        />
        <span class="text-sm text-gray-400">(í•œ ë²ˆì— ìµœëŒ€ 50ê°œì”© ë°˜í™˜, í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ìµœëŒ€ 500ê°œê¹Œì§€ ê°€ëŠ¥)</span>
      </div>
    </div>
    
    <button 
      id="analyzeBtn"
      class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors mb-6"
    >
      ì±„ë„ ë¶„ì„ ì‹œì‘
    </button>

    <div id="status" class="mb-4 text-gray-400"></div>
    <div id="error" class="mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-300 hidden"></div>
    
    <div id="downloadSection" class="mb-4 hidden">
      <div class="flex items-center gap-4 mb-4">
        <button 
          id="downloadBtn"
          class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors"
        >
          ğŸ“¥ CSVë¡œ ë‹¤ìš´ë¡œë“œ
        </button>
        <div class="flex items-center gap-2">
          <label class="text-sm font-medium">ê·¸ë˜í”„ Bin í¬ê¸°:</label>
          <select 
            id="binSize"
            class="px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-700 focus:border-blue-500 focus:outline-none"
          >
            <option value="1">1ì¼</option>
            <option value="3" selected>3ì¼</option>
            <option value="5">5ì¼</option>
            <option value="7">7ì¼</option>
          </select>
        </div>
      </div>
    </div>
    
    <div id="results" class="overflow-x-auto"></div>
  </div>

  <script type="module">
    const MIN_SUBSCRIBER_COUNT = 2000;
    const SEARCH_QUERY = 'ë¶€ì—…';
    const MAX_SEARCH_RESULTS = 50; // ê²€ìƒ‰í•  ìµœëŒ€ ì±„ë„ ê°œìˆ˜ ê¸°ë³¸ê°’ (í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ë” ë§ì´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ)
    let currentChannels = []; // í˜„ì¬ í‘œì‹œëœ ì±„ë„ ë°ì´í„° ì €ì¥

    // Google API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
    function loadClient(apiKey) {
      return new Promise((resolve, reject) => {
        gapi.client.setApiKey(apiKey);
        gapi.client
          .load('https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest')
          .then(
            () => {
              console.log('GAPI client loaded');
              resolve();
            },
            (err) => {
              console.error('Error loading GAPI client', err);
              reject(err);
            }
          );
      });
    }

    // ì±„ë„ ê²€ìƒ‰
    async function searchChannels(query, maxResults = MAX_SEARCH_RESULTS) {
      const allResults = [];
      let nextPageToken;
      let pageCount = 0;
      let totalResults = null; // ë£¨í”„ ë°–ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„ ì–¸

      do {
        const response = await gapi.client.youtube.search.list({
          part: ['snippet'],
          q: query,
          type: 'channel',
          order: 'relevance', // ê´€ë ¨ì„± ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì¼ê´€ì„± í–¥ìƒ
          maxResults: Math.min(maxResults - allResults.length, 50),
          pageToken: nextPageToken,
        });

        pageCount++;
        const itemsInPage = response.result.items ? response.result.items.length : 0;
        totalResults = response.result.pageInfo?.totalResults || null; // ë£¨í”„ ë°–ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì—…ë°ì´íŠ¸
        const resultsPerPage = response.result.pageInfo?.resultsPerPage || 'ì•Œ ìˆ˜ ì—†ìŒ';
        const requestedMaxResults = Math.min(maxResults - allResults.length, 50);
        
        // ì‘ë‹µì—ì„œ ë‹¤ìŒ í˜ì´ì§€ í† í° ê°€ì ¸ì˜¤ê¸°
        const currentNextPageToken = response.result.nextPageToken;
        
        if (response.result.items) {
          allResults.push(...response.result.items);
        }

        // ë‹¤ìŒ í˜ì´ì§€ í† í° ìƒíƒœ ë¶„ì„
        let nextPageStatus = '';
        if (currentNextPageToken) {
          const remaining = typeof totalResults === 'number' ? totalResults - allResults.length : '?';
          nextPageStatus = `ìˆìŒ (ì¶”ê°€ë¡œ ${remaining}ê°œ ì´ìƒ ê°€ëŠ¥)`;
        } else {
          if (typeof totalResults === 'number' && totalResults > allResults.length) {
            nextPageStatus = `ì—†ìŒ âš ï¸ (ì „ì²´ ${totalResults}ê°œ ì¤‘ ${allResults.length}ê°œë§Œ ìˆ˜ì§‘ë¨ - API ì œí•œ ê°€ëŠ¥ì„±)`;
          } else {
            nextPageStatus = `ì—†ìŒ (ì „ì²´ ${allResults.length}ê°œ ìˆ˜ì§‘ ì™„ë£Œ)`;
          }
        }
        
        console.log(`ê²€ìƒ‰ í˜ì´ì§€ ${pageCount}:`, {
          ìš”ì²­í•œ_ê°œìˆ˜: requestedMaxResults,
          ì‹¤ì œ_ë°˜í™˜ëœ_ê°œìˆ˜: itemsInPage,
          ì „ì²´_ì˜ˆìƒ_ê²°ê³¼: totalResults || 'ì•Œ ìˆ˜ ì—†ìŒ',
          í˜ì´ì§€ë‹¹_ê²°ê³¼ìˆ˜: resultsPerPage,
          ë‹¤ìŒí˜ì´ì§€_í† í°: nextPageStatus,
          ëˆ„ì _ê²°ê³¼ìˆ˜: allResults.length
        });

        nextPageToken = currentNextPageToken;
        
        // í˜ì´ì§€ë„¤ì´ì…˜ ì¤‘ë‹¨ ì¡°ê±´: ë” ì´ìƒ í˜ì´ì§€ê°€ ì—†ê±°ë‚˜ ì›í•˜ëŠ” ê°œìˆ˜ì— ë„ë‹¬
        if (!nextPageToken || allResults.length >= maxResults) {
          if (!nextPageToken) {
            if (typeof totalResults === 'number' && totalResults > allResults.length) {
              console.warn(`âš ï¸ ë‹¤ìŒ í˜ì´ì§€ í† í°ì´ ì—†ì§€ë§Œ ì „ì²´ ì˜ˆìƒ ê²°ê³¼(${totalResults}ê°œ)ë³´ë‹¤ ì ì€ ${allResults.length}ê°œë§Œ ìˆ˜ì§‘ë˜ì—ˆìŠµë‹ˆë‹¤.`);
              console.warn('   ê°€ëŠ¥í•œ ì›ì¸:');
              console.warn('   1. YouTube APIê°€ í•´ë‹¹ ê²€ìƒ‰ì–´ì— ëŒ€í•´ ì œí•œëœ ê²°ê³¼ë§Œ ë°˜í™˜');
              console.warn('   2. API í• ë‹¹ëŸ‰ ì œí•œ');
              console.warn('   3. ê²€ìƒ‰ ê²°ê³¼ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ê²½ë¨');
              console.warn(`   4. YouTube APIì˜ totalResults(${totalResults})ì™€ ì‹¤ì œ ë°˜í™˜ ê°€ëŠ¥í•œ ê²°ê³¼ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ`);
            } else {
              console.log(`âœ… ëª¨ë“  ê²°ê³¼ë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤. (ì´ ${allResults.length}ê°œ)`);
            }
          }
          if (allResults.length >= maxResults) {
            console.log(`âœ… ìš”ì²­í•œ ìµœëŒ€ ê°œìˆ˜(${maxResults})ì— ë„ë‹¬í•˜ì—¬ ê²€ìƒ‰ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.`);
          }
          break;
        }
      } while (allResults.length < maxResults);

      console.log(`ì´ ê²€ìƒ‰ ê²°ê³¼: ${allResults.length}ê°œ ì±„ë„ (ìš”ì²­: ${maxResults}ê°œ, ${pageCount}í˜ì´ì§€)`);
      
      if (allResults.length < maxResults && !nextPageToken) {
        console.warn(`âš ï¸ ìš”ì²­í•œ ${maxResults}ê°œë³´ë‹¤ ì ì€ ${allResults.length}ê°œë§Œ ë°˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        console.warn('   ê°€ëŠ¥í•œ ì›ì¸:');
        console.warn('   1. YouTube APIê°€ í•´ë‹¹ ê²€ìƒ‰ì–´ì— ëŒ€í•´ ë” ì ì€ ê²°ê³¼ë§Œ ë°˜í™˜');
        console.warn('   2. API í• ë‹¹ëŸ‰ ì œí•œ');
        console.warn('   3. ê²€ìƒ‰ ê²°ê³¼ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ê²½ë¨');
        console.warn(`   4. ë” ì´ìƒ ê°€ì ¸ì˜¬ í˜ì´ì§€ê°€ ì—†ìŒ (ì „ì²´ ê²°ê³¼: ${totalResults || 'ì•Œ ìˆ˜ ì—†ìŒ'}ê°œ)`);
      } else if (allResults.length >= maxResults) {
        console.log(`âœ… ìš”ì²­í•œ ${maxResults}ê°œ ëª¨ë‘ ìˆ˜ì§‘ ì™„ë£Œ!`);
      }
      
      return allResults;
    }

    // ì±„ë„ ìƒì„¸ ì •ë³´ ì¡°íšŒ
    async function getChannelsDetails(channelIds) {
      const allChannels = [];
      const batchSize = 50;

      for (let i = 0; i < channelIds.length; i += batchSize) {
        const batch = channelIds.slice(i, i + batchSize);
        const response = await gapi.client.youtube.channels.list({
          part: ['snippet', 'statistics', 'contentDetails'],
          id: batch,
        });

        if (response.result.items) {
          allChannels.push(...response.result.items);
        }
      }

      return allChannels;
    }

    // ì±„ë„ì˜ ì—…ë¡œë“œëœ ë™ì˜ìƒ ëª©ë¡ ì¡°íšŒ
    async function getChannelVideos(uploadsPlaylistId, maxResults = 10) {
      const response = await gapi.client.youtube.playlistItems.list({
        part: ['snippet'],
        playlistId: uploadsPlaylistId,
        maxResults: maxResults,
      });

      return response.result.items || [];
    }

    // êµ¬ë…ì ìˆ˜ í•„í„°ë§
    function filterChannelsBySubscriberCount(channels, minCount = MIN_SUBSCRIBER_COUNT) {
      return channels.filter((channel) => {
        const subscriberCount = parseInt(channel.statistics?.subscriberCount || '0', 10);
        return subscriberCount >= minCount;
      });
    }

    // í‰ê·  ì—…ë¡œë“œ ì£¼ê¸° ê³„ì‚°
    function calculateAverageUploadInterval(videos) {
      if (videos.length < 2) {
        return null;
      }

      const sortedVideos = [...videos].sort((a, b) => {
        const dateA = new Date(a.snippet.publishedAt).getTime();
        const dateB = new Date(b.snippet.publishedAt).getTime();
        return dateB - dateA;
      });

      const intervals = [];
      for (let i = 0; i < sortedVideos.length - 1; i++) {
        const date1 = new Date(sortedVideos[i].snippet.publishedAt).getTime();
        const date2 = new Date(sortedVideos[i + 1].snippet.publishedAt).getTime();
        const intervalDays = (date1 - date2) / (1000 * 60 * 60 * 24);
        intervals.push(intervalDays);
      }

      const averageInterval = intervals.reduce((sum, interval) => sum + interval, 0) / intervals.length;
      return Math.round(averageInterval * 10) / 10;
    }

    // ë§ˆì§€ë§‰ ì—…ë¡œë“œì¼ ì¡°íšŒ
    function getLastUploadDate(videos) {
      if (videos.length === 0) {
        return null;
      }

      const sortedVideos = [...videos].sort((a, b) => {
        const dateA = new Date(a.snippet.publishedAt).getTime();
        const dateB = new Date(b.snippet.publishedAt).getTime();
        return dateB - dateA;
      });

      return sortedVideos[0].snippet.publishedAt;
    }

    // ì±„ë„ ë§í¬ ìƒì„±
    function getChannelLink(channel) {
      const customUrl = channel.snippet?.customUrl;
      if (customUrl) {
        return `https://www.youtube.com/${customUrl}`;
      }
      return `https://www.youtube.com/channel/${channel.id}`;
    }

    // ì±„ë„ ì •ë³´ ë³€í™˜
    async function convertToChannelInfo(channel) {
      const uploadsPlaylistId = channel.contentDetails?.relatedPlaylists?.uploads;

      let lastUploadDate = null;
      let averageUploadInterval = null;

      if (uploadsPlaylistId) {
        try {
          const videos = await getChannelVideos(uploadsPlaylistId, 10);
          lastUploadDate = getLastUploadDate(videos);
          averageUploadInterval = calculateAverageUploadInterval(videos);
        } catch (error) {
          console.error(`Failed to get videos for channel ${channel.id}:`, error);
        }
      }

      return {
        id: channel.id,
        title: channel.snippet.title,
        subscriberCount: parseInt(channel.statistics.subscriberCount || '0', 10),
        channelLink: getChannelLink(channel),
        lastUploadDate,
        averageUploadInterval,
      };
    }

    // ë‚ ì§œ í¬ë§·íŒ…
    function formatDate(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      });
    }

    // êµ¬ë…ì ìˆ˜ í¬ë§·íŒ…
    function formatSubscriberCount(count) {
      if (count >= 1000000) {
        return `${(count / 1000000).toFixed(1)}M`;
      }
      if (count >= 1000) {
        return `${(count / 1000).toFixed(1)}K`;
      }
      return count.toLocaleString();
    }

    // ì—…ë¡œë“œ ì£¼ê¸° í¬ë§·íŒ… (ìˆ«ìë§Œ ë°˜í™˜)
    function formatUploadInterval(interval) {
      if (interval === null) return '-';
      return interval.toFixed(1);
    }

    // í‰ê·  ì—…ë¡œë“œ ì£¼ê¸° íˆìŠ¤í† ê·¸ë¨ ìƒì„±
    function generateUploadIntervalChart(channels, binSize = 3) {
      // í‰ê·  ì—…ë¡œë“œ ì£¼ê¸°ê°€ ìˆëŠ” ì±„ë„ë§Œ í•„í„°ë§
      const channelsWithInterval = channels.filter(c => c.averageUploadInterval !== null);
      
      if (channelsWithInterval.length === 0) {
        return '<div class="text-gray-400 mt-8">ê·¸ë˜í”„ë¥¼ í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
      }

      // íˆìŠ¤í† ê·¸ë¨ ë°ì´í„° ìƒì„±
      const intervals = channelsWithInterval.map(c => c.averageUploadInterval);
      const minInterval = Math.min(...intervals);
      const maxInterval = Math.max(...intervals);
      
      // Bin ìƒì„± - í•­ìƒ 0ë¶€í„° ì‹œì‘
      const bins = [];
      const startBin = 0; // í•­ìƒ 0ë¶€í„° ì‹œì‘
      const endBin = Math.ceil(maxInterval / binSize) * binSize; // binSizeì˜ ë°°ìˆ˜ë¡œ ì˜¬ë¦¼
      
      for (let i = startBin; i < endBin; i += binSize) {
        const binEnd = i + binSize;
        const count = intervals.filter(interval => interval >= i && interval < binEnd).length;
        bins.push({
          start: i,
          end: binEnd,
          count: count,
          label: `${i}~${binEnd}`
        });
      }
      
      // ë§ˆì§€ë§‰ binì— ì •í™•íˆ maxIntervalì´ í¬í•¨ë˜ë„ë¡ ì²˜ë¦¬
      const lastBin = bins[bins.length - 1];
      if (lastBin && maxInterval >= lastBin.end) {
        // ë§ˆì§€ë§‰ binì„ í™•ì¥
        const extendedEnd = Math.ceil((maxInterval + 1) / binSize) * binSize;
        lastBin.end = extendedEnd;
        lastBin.label = `${lastBin.start}~${extendedEnd}`;
      }

      const maxCount = Math.max(...bins.map(b => b.count));
      const chartHeight = 400;
      const barWidth = Math.max(30, Math.min(80, (800 / bins.length) - 5));

      let chartHtml = `
        <div class="mt-8 bg-gray-800 rounded-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-white">í‰ê·  ì—…ë¡œë“œ ì£¼ê¸° ë¶„í¬ (íˆìŠ¤í† ê·¸ë¨)</h2>
          <div class="flex items-end gap-1 justify-center" style="height: ${chartHeight}px; overflow-x: auto;">
      `;

      bins.forEach((bin, index) => {
        const height = maxCount > 0 ? (bin.count / maxCount) * (chartHeight - 80) : 0;
        const barColor = `hsl(${200 + (index * 15) % 160}, 70%, 50%)`;
        
        chartHtml += `
          <div class="flex flex-col items-center relative group" style="min-width: ${barWidth}px;">
            <div 
              class="bg-blue-500 hover:bg-blue-400 transition-colors rounded-t cursor-pointer relative"
              style="width: ${barWidth}px; height: ${height}px; background-color: ${barColor}; min-height: ${height > 0 ? '4px' : '0'};"
              title="${bin.label}: ${bin.count}ê°œ ì±„ë„"
            >
              <div class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-10">
                ${bin.label}: ${bin.count}ê°œ
              </div>
            </div>
            <div class="mt-2 text-xs text-gray-400 text-center" style="writing-mode: horizontal-tb; transform: rotate(-45deg); transform-origin: center; width: ${barWidth * 1.5}px;">
              ${bin.start}
            </div>
            ${bin.count > 0 ? `<div class="text-xs text-white font-semibold mt-1">${bin.count}</div>` : ''}
          </div>
        `;
      });

      chartHtml += `
          </div>
          <div class="mt-6 flex justify-between items-center">
            <div class="text-sm text-gray-400">
              ì´ ${channelsWithInterval.length}ê°œ ì±„ë„, Bin í¬ê¸°: ${binSize}ì¼
            </div>
            <div class="text-sm text-gray-400">
              ë²”ìœ„: ${minInterval.toFixed(1)} ~ ${maxInterval.toFixed(1)}ì¼
            </div>
          </div>
        </div>
      `;

      return chartHtml;
    }

    // CSV ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
    function downloadCSV(channels) {
      if (channels.length === 0) {
        alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // CSV í—¤ë”
      const headers = ['ì±„ë„ ID', 'ì±„ë„ëª…', 'êµ¬ë…ì ìˆ˜', 'ì±„ë„ ë§í¬', 'ë§ˆì§€ë§‰ ì—…ë¡œë“œì¼', 'í‰ê·  ì—…ë¡œë“œ ì£¼ê¸°'];
      
      // CSV ë°ì´í„° ìƒì„±
      const csvRows = [headers.join(',')];

      channels.forEach((channel) => {
        const row = [
          channel.id,
          `"${channel.title.replace(/"/g, '""')}"`, // ìŒë”°ì˜´í‘œ ì´ìŠ¤ì¼€ì´í”„
          channel.subscriberCount,
          channel.channelLink,
          channel.lastUploadDate ? formatDate(channel.lastUploadDate) : '-',
          channel.averageUploadInterval !== null ? formatUploadInterval(channel.averageUploadInterval) : '-'
        ];
        csvRows.push(row.join(','));
      });

      // BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
      const csvContent = '\uFEFF' + csvRows.join('\n');
      
      // Blob ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `youtube_channels_${SEARCH_QUERY}_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // ê²°ê³¼ í‘œì‹œ
    function displayResults(channels) {
      const resultsDiv = document.getElementById('results');
      const downloadSection = document.getElementById('downloadSection');
      
      // ì±„ë„ ë°ì´í„° ì €ì¥
      currentChannels = channels;
      
      if (channels.length === 0) {
        resultsDiv.innerHTML = '<div class="text-gray-400">í‘œì‹œí•  ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        downloadSection.classList.add('hidden');
        return;
      }

      // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í‘œì‹œ
      downloadSection.classList.remove('hidden');

      let html = `
        <div class="mb-4 text-gray-400">
          ì´ <span class="text-white font-semibold">${channels.length}</span>ê°œì˜ ì±„ë„ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.
        </div>
        <table class="w-full border-collapse bg-gray-800 rounded-lg overflow-hidden mb-8">
          <thead>
            <tr class="bg-gray-700 border-b border-gray-600">
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-300">ì±„ë„ ID</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-300">ì±„ë„ëª…</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-300">êµ¬ë…ì ìˆ˜</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-300">ì±„ë„ ë§í¬</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-300">ë§ˆì§€ë§‰ ì—…ë¡œë“œì¼</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-300">í‰ê·  ì—…ë¡œë“œ ì£¼ê¸°</th>
            </tr>
          </thead>
          <tbody>
      `;

      channels.forEach((channel) => {
        html += `
          <tr class="border-b border-gray-700/50 hover:bg-gray-700/50 transition-colors">
            <td class="px-6 py-4 text-sm text-gray-400 font-mono">${channel.id}</td>
            <td class="px-6 py-4 text-sm text-white font-medium">${channel.title}</td>
            <td class="px-6 py-4 text-sm text-gray-300">${formatSubscriberCount(channel.subscriberCount)}</td>
            <td class="px-6 py-4 text-sm">
              <a href="${channel.channelLink}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">
                ì±„ë„ ë³´ê¸°
              </a>
            </td>
            <td class="px-6 py-4 text-sm text-gray-300">${formatDate(channel.lastUploadDate)}</td>
            <td class="px-6 py-4 text-sm text-gray-300">${formatUploadInterval(channel.averageUploadInterval)}</td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
      `;

      // ê·¸ë˜í”„ ì¶”ê°€
      const binSize = parseInt(document.getElementById('binSize')?.value || '3', 10);
      html += generateUploadIntervalChart(channels, binSize);

      resultsDiv.innerHTML = html;
      
      // Bin í¬ê¸° ë³€ê²½ ì‹œ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
      const binSizeSelect = document.getElementById('binSize');
      if (binSizeSelect) {
        binSizeSelect.onchange = () => {
          const newBinSize = parseInt(binSizeSelect.value, 10);
          const newChart = generateUploadIntervalChart(channels, newBinSize);
          const chartContainer = resultsDiv.querySelector('.bg-gray-800.rounded-lg.p-6:last-child');
          if (chartContainer) {
            chartContainer.outerHTML = newChart;
          }
        };
      }
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
    }

    function hideError() {
      document.getElementById('error').classList.add('hidden');
    }

    // ë©”ì¸ ë¶„ì„ í•¨ìˆ˜
    async function analyzeChannels() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const maxResultsInput = document.getElementById('maxResults').value;
      const maxResults = Math.min(Math.max(parseInt(maxResultsInput) || MAX_SEARCH_RESULTS, 1), 500);
      
      if (!apiKey) {
        showError('YouTube API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (maxResults < 1 || maxResults > 500) {
        showError('ê²€ìƒ‰ ê°œìˆ˜ëŠ” 1~500 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }

      const analyzeBtn = document.getElementById('analyzeBtn');
      analyzeBtn.disabled = true;
      analyzeBtn.textContent = 'ë¶„ì„ ì¤‘...';
      hideError();
      document.getElementById('results').innerHTML = '';
      const downloadSection = document.getElementById('downloadSection');
      downloadSection.classList.add('hidden');
      // Bin í¬ê¸° ì„ íƒ ì´ˆê¸°í™”
      const binSizeSelect = document.getElementById('binSize');
      if (binSizeSelect) {
        binSizeSelect.value = '3';
      }
      currentChannels = [];

      try {
        // API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        updateStatus('YouTube API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì¤‘...');
        await loadClient(apiKey);

        // ì±„ë„ ê²€ìƒ‰
        updateStatus(`ê²€ìƒ‰ì–´ "${SEARCH_QUERY}"ë¡œ ì±„ë„ ê²€ìƒ‰ ì¤‘... (ìµœëŒ€ ${maxResults}ê°œ)`);
        const searchResults = await searchChannels(SEARCH_QUERY, maxResults);
        const channelIds = searchResults.map((result) => result.id.channelId);

        if (channelIds.length === 0) {
          updateStatus('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
          analyzeBtn.disabled = false;
          analyzeBtn.textContent = 'ì±„ë„ ë¶„ì„ ì‹œì‘';
          return;
        }

        console.log(`ê²€ìƒ‰ëœ ì±„ë„ ID ê°œìˆ˜: ${channelIds.length}`);
        updateStatus(`${channelIds.length}ê°œì˜ ì±„ë„ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤. (ê²€ìƒ‰ ë‹¨ê³„)`);

        // ì±„ë„ ìƒì„¸ ì •ë³´ ì¡°íšŒ
        updateStatus('ì±„ë„ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì¤‘...');
        const channels = await getChannelsDetails(channelIds);
        console.log(`ìƒì„¸ ì •ë³´ ì¡°íšŒ ì™„ë£Œ: ${channels.length}ê°œ ì±„ë„`);

        // êµ¬ë…ì ìˆ˜ í•„í„°ë§
        updateStatus(`êµ¬ë…ì ìˆ˜ ${MIN_SUBSCRIBER_COUNT} ì´ìƒì¸ ì±„ë„ í•„í„°ë§ ì¤‘...`);
        const filteredChannels = filterChannelsBySubscriberCount(channels, MIN_SUBSCRIBER_COUNT);
        console.log(`í•„í„°ë§ ê²°ê³¼: ${filteredChannels.length}ê°œ ì±„ë„ (ê²€ìƒ‰: ${channelIds.length}ê°œ â†’ ìƒì„¸ì¡°íšŒ: ${channels.length}ê°œ â†’ í•„í„°ë§: ${filteredChannels.length}ê°œ)`);
        updateStatus(`${filteredChannels.length}ê°œì˜ ì±„ë„ì´ ê¸°ì¤€ì„ ë§Œì¡±í•©ë‹ˆë‹¤.`);

        // ê° ì±„ë„ì˜ ì¶”ê°€ ì •ë³´ ìˆ˜ì§‘
        updateStatus('ì±„ë„ë³„ ìƒì„¸ ì •ë³´ ìˆ˜ì§‘ ì¤‘...');
        const channelInfos = [];

        for (let i = 0; i < filteredChannels.length; i++) {
          const channel = filteredChannels[i];
          updateStatus(`[${i + 1}/${filteredChannels.length}] ${channel.snippet.title} ë¶„ì„ ì¤‘...`);
          
          try {
            const channelInfo = await convertToChannelInfo(channel);
            channelInfos.push(channelInfo);
          } catch (error) {
            console.error(`ì±„ë„ ${channel.id} ë¶„ì„ ì‹¤íŒ¨:`, error);
          }

          // API í• ë‹¹ëŸ‰ì„ ê³ ë ¤í•˜ì—¬ ì•½ê°„ì˜ ì§€ì—° ì¶”ê°€
          if (i < filteredChannels.length - 1) {
            await new Promise((resolve) => setTimeout(resolve, 100));
          }
        }

        updateStatus(`ë¶„ì„ ì™„ë£Œ! ì´ ${channelInfos.length}ê°œì˜ ì±„ë„ ì •ë³´ë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤.`);
        displayResults(channelInfos);

      } catch (error) {
        console.error('ì±„ë„ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        showError(error.message || 'ì±„ë„ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        updateStatus('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.textContent = 'ì±„ë„ ë¶„ì„ ì‹œì‘';
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.getElementById('analyzeBtn').addEventListener('click', analyzeChannels);
    document.getElementById('downloadBtn').addEventListener('click', () => {
      downloadCSV(currentChannels);
    });
    
    // Enter í‚¤ë¡œë„ ì‹¤í–‰ ê°€ëŠ¥
    document.getElementById('apiKey').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        analyzeChannels();
      }
    });

    // gapi ë¡œë“œ ëŒ€ê¸°
    gapi.load('client', () => {
      console.log('Google API loaded');
    });
  </script>
</body>
</html>
